<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HS Smart Wearverse – 3D Try-on Demo</title>
  <style>
    html, body { margin:0; height:100%; background:#0b1320; font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    #app { position:relative; height:100%; }
    canvas { display:block; }
    .panel {
      position:absolute; top:16px; right:16px; width:280px; padding:14px 14px 12px;
      background:rgba(255,255,255,.94); border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35);
      backdrop-filter: blur(6px);
    }
    .panel h2 { margin:0 0 10px; font-size:16px; letter-spacing:.5px; }
    .row { display:flex; align-items:center; justify-content:space-between; gap:10px; margin:8px 0; }
    .row label { font-size:13px; color:#111827; white-space:nowrap; }
    .row select, .row input[type="color"] {
      flex:1; padding:8px 10px; border-radius:10px; border:1px solid #e5e7eb; background:#fff; font-size:13px;
    }
    .badge { display:inline-block; padding:4px 8px; background:#e8f5ff; color:#0369a1; border-radius:999px; font-size:12px; margin-bottom:6px; }
    .footer { margin-top:8px; font-size:11px; color:#6b7280; text-align:right; }
    .btn {
      width:100%; margin-top:8px; padding:10px 12px; border-radius:12px; border:0; background:#111827; color:#fff; font-weight:600; cursor:pointer;
    }
    .btn:active { transform: translateY(1px); }
  </style>
</head>
<body>
  <div id="app"></div>

  <div class="panel">
    <span class="badge">虛擬試衣 · 即時預覽</span>
    <h2>目前配置</h2>
    <div class="row">
      <label>袖型</label>
      <select id="sleeve">
        <option value="short">short-sleeve</option>
        <option value="long">long-sleeve</option>
      </select>
    </div>
    <div class="row">
      <label>領型</label>
      <select id="neck">
        <option value="crew">crew-neck</option>
        <option value="v">v-neck</option>
      </select>
    </div>
    <div class="row">
      <label>顏色</label>
      <input id="color" type="color" value="#ffffff" />
    </div>
    <div class="row">
      <label>尺寸</label>
      <select id="size">
        <option value="S">S</option>
        <option value="M" selected>M</option>
        <option value="L">L</option>
      </select>
    </div>
    <button class="btn" id="sync">即時同步</button>
    <div class="footer">旋轉：拖曳 · 縮放：滾輪</div>
  </div>

  <script type="module">
    import * as THREE from "https://unpkg.com/three@0.160.0/build/three.module.js";
    import { OrbitControls } from "https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js";

    // --- 基本場景 ---
    const app = document.getElementById("app");
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0b1320);

    const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 100);
    camera.position.set(2.8, 2.2, 4.6);

    const renderer = new THREE.WebGLRenderer({ antialias:true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    app.appendChild(renderer.domElement);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.target.set(0, 1.6, 0);

    // 環境光 + 定向光
    scene.add(new THREE.HemisphereLight(0xffffff, 0x334155, 0.8));
    const dir = new THREE.DirectionalLight(0xffffff, 0.9);
    dir.position.set(3, 6, 3);
    dir.castShadow = true;
    scene.add(dir);

    // 地面
    const ground = new THREE.Mesh(
      new THREE.CylinderGeometry(10, 10, 0.1, 64),
      new THREE.MeshStandardMaterial({ color: 0x0f172a, roughness: 1 })
    );
    ground.receiveShadow = true;
    ground.position.y = -0.05;
    scene.add(ground);

    // --- 建立中性假人（無裸露細節） ---
    const skin = new THREE.MeshStandardMaterial({ color: 0xd6b79b, roughness:.95, metalness:0 });
    const mannequin = new THREE.Group();

    // 軀幹（圓柱）
    const torso = new THREE.Mesh(
      new THREE.CylinderGeometry(0.55, 0.7, 1.45, 24),
      skin
    );
    torso.castShadow = true;
    torso.position.y = 1.6;
    mannequin.add(torso);

    // 頭
    const head = new THREE.Mesh(
      new THREE.SphereGeometry(0.35, 24, 16),
      skin
    );
    head.position.y = 2.6;
    head.castShadow = true;
    mannequin.add(head);

    // 手臂
    function armMesh(side = 1) {
      const a = new THREE.Mesh(new THREE.CylinderGeometry(0.18, 0.18, 1.1, 16), skin);
      a.castShadow = true;
      a.position.set(0.9*side, 1.55, 0);
      a.rotation.z = -0.35*side; // 往下傾
      return a;
    }
    mannequin.add(armMesh(1), armMesh(-1));

    // 腿
    function legMesh(side = 1) {
      const l = new THREE.Mesh(new THREE.CylinderGeometry(0.22, 0.25, 1.35, 18), skin);
      l.castShadow = true;
      l.position.set(0.28*side, 0.7, 0);
      return l;
    }
    mannequin.add(legMesh(1), legMesh(-1));

    scene.add(mannequin);

    // --- 衣服組件（可換色/袖長/領口/尺寸） ---
    const shirtGroup = new THREE.Group();
    scene.add(shirtGroup);

    const shirtMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness:.6, metalness:0.05 });

    // 主衣身（比軀幹稍大）
    const body = new THREE.Mesh(
      new THREE.CylinderGeometry(0.60, 0.75, 1.48, 32),
      shirtMat
    );
    body.position.y = 1.6;
    body.castShadow = true;
    shirtGroup.add(body);

    // 領口（crew 用）
    const crewNeck = new THREE.Mesh(
      new THREE.TorusGeometry(0.24, 0.035, 16, 64),
      shirtMat
    );
    crewNeck.rotation.x = Math.PI/2;
    crewNeck.position.set(0, 2.18, 0.03);
    shirtGroup.add(crewNeck);

    // V 領（用線條裝飾）
    const vGeo = new THREE.BufferGeometry().setFromPoints([
      new THREE.Vector3(-0.18, 0.12, 0.26),
      new THREE.Vector3( 0.00,-0.06, 0.29),
      new THREE.Vector3( 0.18, 0.12, 0.26),
    ]);
    const vNeck = new THREE.Line(vGeo, new THREE.LineBasicMaterial({ color: 0x111111, linewidth: 3 }));
    vNeck.position.y = 2.12;
    vNeck.visible = false;
    shirtGroup.add(vNeck);

    // 袖子群組（依袖長重建）
    const sleeves = new THREE.Group();
    shirtGroup.add(sleeves);

    function buildSleeves(type="short") {
      sleeves.clear();
      const isShort = type === "short";
      const len = isShort ? 0.42 : 1.05;

      function sleeve(side=1) {
        const s = new THREE.Mesh(new THREE.CylinderGeometry(0.22, 0.22, len, 18), shirtMat);
        s.castShadow = true;
        s.position.set(0.92*side, 1.58, 0);
        s.rotation.z = -0.35*side;
        // 往手臂外推一點，避免重疊
        s.position.x += 0.05*side;
        return s;
      }
      sleeves.add(sleeve(1), sleeve(-1));
    }
    buildSleeves("short");

    // 尺寸縮放（對衣服做 X/Z 比例縮放）
    const sizeScale = { S: 0.97, M: 1.00, L: 1.06 };
    function applySize(sz="M"){
      const k = sizeScale[sz] ?? 1.0;
      shirtGroup.scale.set(k, 1.0, k);
    }
    applySize("M");

    // UI 綁定
    const $sleeve = document.getElementById("sleeve");
    const $neck   = document.getElementById("neck");
    const $color  = document.getElementById("color");
    const $size   = document.getElementById("size");
    const $sync   = document.getElementById("sync");

    function syncUI(){
      // 顏色
      shirtMat.color = new THREE.Color($color.value);

      // 袖長
      buildSleeves($sleeve.value);

      // 領型
      const isV = ($neck.value === "v");
      vNeck.visible = isV;
      crewNeck.visible = !isV;

      // 尺碼
      applySize($size.value);
    }
    $sync.addEventListener("click", syncUI);

    // 初始動畫
    function onResize(){
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }
    window.addEventListener("resize", onResize);

    // 簡單慢速自轉（展示用）
    let t = 0;
    function animate(){
      requestAnimationFrame(animate);
      controls.update();
      t += 0.005;
      mannequin.rotation.y = Math.sin(t)*0.02;
      shirtGroup.rotation.y = mannequin.rotation.y;
      renderer.render(scene, camera);
    }
    animate();

    // 提示：若之後要換成擬真 3D 模特，保留衣服群組（shirtGroup），把 mannequin 換成載入 GLB/FBX 即可。
    // 例：import { GLTFLoader } from ".../GLTFLoader.js"; 然後 loader.load("model.glb", (g)=>{ scene.add(g.scene); })
  </script>
</body>
</html>
